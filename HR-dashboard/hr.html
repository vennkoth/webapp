<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>HR Dashboard - Posspole</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
    }

    .sidebar {
      background-color: black; 
      color: white;
      width: 240px;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding: 2rem 1rem;
      display: flex;
      flex-direction: column;
    }

    .sidebar a {
      color: white;
      padding: 0.75rem 1rem;
      margin-bottom: 0.5rem;
      border-radius: 0.5rem;
      transition: background 0.3s;
    }

    .sidebar a:hover {
      background-color: #1e232b;
    }

    .sidebar a.active {
      background-color: #374151;
      color: white;
    }

    .main-content {
      margin-left: 260px;
      padding: 2rem;
    }

    .download-btn {
      background-color: #000;
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .download-btn:hover {
      background-color: #222;
      transform: scale(1.05);
    }

    footer {
      margin-top: 40px;
      background-color: #f9f9f9;
      padding: 20px;
      text-align: center;
      font-size: 14px;
      border-top: 1px solid #e2e2e2;
    }

    input, select, button {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      background: black;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #333;
    }
  </style>
</head>
<body>

 <!-- Sidebar -->
 <div class="sidebar">
  <img src="/components/posspolelogo.png" alt="Posspole Logo" class="h-6 mb-8 mx-auto">
  <a href="/HR-dashboard/hr.html" class="active hover:bg-gray-700 hover:text-white">Candidates</a>
  <a href="/HR-dashboard/test.html" class="hover:bg-gray-700 hover:text-white">Test</a>
  <a href="/HR-dashboard/report.html" class="hover:bg-gray-700 hover:text-white">Report</a>
  <a href="/login-page/login.html" id="logoutBtn" class="mt-auto hover:bg-gray-700 hover:text-white">Logout</a>
</div>

  <!-- Main Content -->
  <div class="main-content">
    <h1 class="text-4xl font-bold mb-6">HR Dashboard</h1>

    <!-- Search and Filter -->
    <div class="mb-6 bg-gray-50 p-4 rounded-lg border border-gray-200 flex flex-wrap gap-4 items-center">
      <input type="text" id="searchName" placeholder="Search by Name" class="w-64">
      <input type="text" id="searchTime" placeholder="Search by Time (e.g., 10:00 AM)" class="w-64">
      <select id="sortBy" class="w-48">
        <option value="">Sort By</option>
        <option value="name-asc">Name A-Z</option>
        <option value="name-desc">Name Z-A</option>
        <option value="time-asc">Time Asc</option>
        <option value="time-desc">Time Desc</option>
      </select>
      <button onclick="applySearch()">Search</button>
      <button onclick="clearSearch()" class="bg-gray-600 hover:bg-gray-800">Clear</button>
    </div>

    <!-- Users Table -->
    <div class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-2xl font-semibold mb-4">Candidates</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full text-left border-collapse">
          <thead class="bg-gray-100 font-semibold">
            <tr>
              <th class="p-3">User ID</th>
              <th class="p-3">Name</th>
              <th class="p-3">Email</th>
              <th class="p-3">Resume</th>
            </tr>
          </thead>
          <tbody id="userTable" class="divide-y">
            <!-- Rows go here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <p>About Us | <a href="https://posspole.com/" target="_blank" class="text-blue-600 underline">Visit Posspole</a></p>
      <p>&copy; 2025 Posspole. All rights reserved.</p>
    </footer>
  </div>

  <!-- JavaScript -->
  <script>
let users = [];

async function fetchUsers() {
  try {
    const res = await fetch("http://localhost:5001/api/auth/hr/candidates");
    const data = await res.json();
    users = data.users; // assuming response format: { users: [...] }
    renderUsers(users);
  } catch (err) {
    console.error("Error fetching users:", err);
    alert("Failed to load candidates.");
  }
}


    function renderUsers(data) {
      const table = document.getElementById("userTable");
      table.innerHTML = "";
      data.forEach(user => {
        table.innerHTML += `
          <tr>
            <td class="p-3">${user._id}</td>
            <td class="p-3">${user.fullName}</td>
            <td class="p-3">${user.email}</td>
            <td class="p-3">
              <a href="${user.resumeUrl || '#'}" class="download-btn" download>Download</a>

            </td>
          </tr>
        `;
      });
    }

    function parseTime(timeStr) {
      const [time, meridian] = timeStr.split(" ");
      let [hours, minutes] = time.split(":").map(Number);
      if (meridian === "PM" && hours !== 12) hours += 12;
      if (meridian === "AM" && hours === 12) hours = 0;
      return hours * 60 + minutes;
    }

    function applySearch() {
      const nameInput = document.getElementById("searchName").value.toLowerCase();
      const timeInput = document.getElementById("searchTime").value.toLowerCase();
      const sortBy = document.getElementById("sortBy").value;

      let filtered = users.filter(user =>
        user.name.toLowerCase().includes(nameInput) &&
        user.time.toLowerCase().includes(timeInput)
      );

      switch (sortBy) {
        case "name-asc":
          filtered.sort((a, b) => a.name.localeCompare(b.name));
          break;
        case "name-desc":
          filtered.sort((a, b) => b.name.localeCompare(a.name));
          break;
        case "time-asc":
          filtered.sort((a, b) => parseTime(a.time) - parseTime(b.time));
          break;
        case "time-desc":
          filtered.sort((a, b) => parseTime(b.time) - parseTime(a.time));
          break;
      }

      renderUsers(filtered);
    }

    function clearSearch() {
      document.getElementById("searchName").value = "";
      document.getElementById("searchTime").value = "";
      document.getElementById("sortBy").value = "";
      renderUsers(users);
    }

    window.onload = () => {
      fetchUsers();
    };
      // Universal logout confirmation for all HR-dashboard pages
    function setupLogoutButton() {
        const logoutBtn = document.getElementById('logoutBtn');
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function (e) {
                e.preventDefault();
                // Use a custom modal for confirmation with Cancel/Logout buttons
                if (document.getElementById('logout-modal')) return; // Prevent multiple modals

                const modal = document.createElement('div');
                modal.id = 'logout-modal';
                modal.style.position = 'fixed';
                modal.style.top = 0;
                modal.style.left = 0;
                modal.style.width = '100vw';
                modal.style.height = '100vh';
                modal.style.background = 'rgba(0,0,0,0.4)';
                modal.style.display = 'flex';
                modal.style.alignItems = 'center';
                modal.style.justifyContent = 'center';
                modal.style.zIndex = 9999;
                modal.innerHTML = `
                  <div style="background:#fff;padding:2rem 2.5rem;border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,0.18);max-width:350px;text-align:center;">
                    <h2 class="text-xl font-bold mb-4">Log out?</h2>
                    <p class="mb-6">Are you sure you want to log out?</p>
                    <div style="display:flex;gap:1rem;justify-content:center;">
                      <button id="cancel-logout" style="padding:0.5rem 1.5rem;border-radius:8px;background:#e5e7eb;color:#222;border:none;font-weight:500;cursor:pointer;">Cancel</button>
                      <button id="confirm-logout" style="padding:0.5rem 1.5rem;border-radius:8px;background:#000;color:#fff;border:none;font-weight:500;cursor:pointer;">Logout</button>
                    </div>
                  </div>
                `;
                document.body.appendChild(modal);

                document.getElementById('cancel-logout').onclick = function() {
                    document.body.removeChild(modal);
                };
                document.getElementById('confirm-logout').onclick = function() {
                    localStorage.clear();
                    sessionStorage.clear();
                    window.location.href = '/login-page/login.html';
                };
            });
        }
    }
    setupLogoutButton();
  </script>
  <script src="/user-dashboard/user-page.js"></script>
</body>
</html>
