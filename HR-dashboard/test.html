<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Test Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .sidebar {
            background-color: black;
            color: white;
            width: 240px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
        }
        .sidebar a {
            color: white;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.3s;
            text-decoration: none;
        }
        .sidebar a:hover {
            background-color: #1e232b;
        }
        .sidebar a.active {
            background-color: #374151;
            color: white;
        }
        .sidebar a:hover {
            background-color: #333333;
        }
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
        }
        .sidebar {
            background-color: black;
            color: white;
            width: 240px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
        }
        .sidebar a {
            color: white;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            transition: background 0.3s;
            text-decoration: none;
        }
        .sidebar a:hover {
            background-color: #1e232b;
        }
        .sidebar a.active {
            background-color: #374151;
        }
        .content {
            margin-left: 250px;
            padding: 20px;
            background-color: #f5f5f5;
            min-height: 100vh;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal-content {
            background-color: #ffffff;
            margin: 10% auto;
            padding: 20px;
            width: 80%;
            max-width: 600px;
            border-radius: 8px;
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #1a1a1a;
        }
        .multiselect {
            position: relative;
        }
        .multiselect-options {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
        }
        .multiselect-options label {
            display: block;
            padding: 8px;
            color: #1a1a1a;
        }
        .multiselect-options label:hover {
            background-color: #f5f5f5;
        }
        .question-item {
            border-bottom: 1px solid #d1d5db;
            padding: 10px 0;
        }
        .question-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="sidebar flex flex-col h-full">
        <img src="/components/posspolelogo.png" alt="Posspole Logo" class="h-6 mb-8 mx-auto">
        <a href="/HR-dashboard/hr.html" class="hover:bg-gray-700 hover:text-white">Candidates</a>
        <a href="/HR-dashboard/test.html" class="active hover:bg-gray-700 hover:text-white">Test</a>
        <a href="/HR-dashboard/report.html" class="hover:bg-gray-700 hover:text-white">Report</a>
        <a href="#" class="mt-auto hover:bg-gray-700 hover:text-white">Settings</a>
    </div>

    <!-- Main Content -->
    <div class="content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-semibold text-[#1a1a1a]">Tests</h2>
            <button id="add-test-btn" class="bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                Add New Test
            </button>
        </div>

        <!-- Filters Section -->
        <div class="bg-white p-4 rounded-lg shadow mb-6">
            <h3 class="text-lg font-semibold mb-4 text-[#1a1a1a]">Filters</h3>
            <div class="flex flex-wrap gap-4">
                <!-- Date Range Filter -->
                <div>
                    <label class="block text-sm font-medium mb-1 text-[#1a1a1a]">Date Range</label>
                    <div class="flex gap-2">
                        <input type="date" id="start-date" class="p-2 border border-[#d1d5db] rounded text-[#1a1a1a]">
                        <span class="text-[#1a1a1a]">to</span>
                        <input type="date" id="end-date" class="p-2 border border-[#d1d5db] rounded text-[#1a1a1a]">
                    </div>
                </div>

                <!-- Role Filter -->
                <div>
                    <label class="block text-sm font-medium mb-1 text-[#1a1a1a]">Role</label>
                    <div class="multiselect">
                        <div id="role-select" class="p-2 border border-[#d1d5db] rounded cursor-pointer text-[#1a1a1a]">
                            Select Roles
                        </div>
                        <div id="role-options" class="multiselect-options">
                            <label><input type="checkbox" value="Digital Marketing" class="mr-2">Digital Marketing</label>
                            <label><input type="checkbox" value="SDE" class="mr-2">SDE</label>
                            <label><input type="checkbox" value="Business Analyst" class="mr-2">Business Analyst</label>
                            <label><input type="checkbox" value="Data Analyst" class="mr-2">Data Analyst</label>
                            <label><input type="checkbox" value="Solution Engineer" class="mr-2">Solution Engineer</label>
                        </div>
                    </div>
                </div>

                <!-- Clear Filters Button -->
                <button id="clear-filters" class="bg-[#d1d5db] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#9ca3af]">
                    Clear Filters
                </button>
            </div>
        </div>

        <!-- Tests Table -->
        <div class="bg-white p-4 rounded-lg shadow">
            <table class="w-full text-left">
                <thead>
                    <tr class="border-b border-[#d1d5db]">
                        <th class="p-3 text-[#1a1a1a]">Test Name</th>
                        <th class="p-3 text-[#1a1a1a]">Role</th>
                        <th class="p-3 text-[#1a1a1a]">Date Added</th>
                        <th class="p-3 text-[#1a1a1a]">Actions</th>
                    </tr>
                </thead>
                <tbody id="tests-table-body">
                    <!-- Tests will be dynamically added here -->
                </tbody>
            </table>
        </div>

        <!-- Add Test Modal -->
        <div id="add-test-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">×</span>
                <h3 class="text-xl font-semibold mb-4 text-[#1a1a1a]">Add New Test</h3>
                <form id="add-test-form">
                    <div class="mb-4">
                        <label for="test-name" class="block text-sm font-medium text-[#1a1a1a]">Test Name</label>
                        <input type="text" id="test-name" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required>
                    </div>
                    <div class="mb-4">
                        <label for="test-role" class="block text-sm font-medium text-[#1a1a1a]">Role</label>
                        <select id="test-role" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required>
                            <option value="Digital Marketing">Digital Marketing</option>
                            <option value="SDE">SDE</option>
                            <option value="Business Analyst">Business Analyst</option>
                            <option value="Data Analyst">Data Analyst</option>
                            <option value="Solution Engineer">Solution Engineer</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="test-duration" class="block text-sm font-medium text-[#1a1a1a]">Duration (minutes)</label>
                        <input type="number" id="test-duration" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required>
                    </div>
                    <button type="submit" class="bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                        Add Test
                    </button>
                </form>
            </div>
        </div>

        <!-- Test Details Modal -->
        <div id="test-details-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">×</span>
                <h3 class="text-xl font-semibold mb-4 text-[#1a1a1a]">Test Details</h3>
                <div id="test-details-content">
                    <p class="text-[#1a1a1a]"><strong>Test Name:</strong> <span id="details-test-name"></span></p>
                    <p class="text-[#1a1a1a]"><strong>Role:</strong> <span id="details-role"></span></p>
                    <p class="text-[#1a1a1a]"><strong>Date Added:</strong> <span id="details-date-added"></span></p>
                    <p class="text-[#1a1a1a]"><strong>Duration:</strong> <span id="details-duration"></span> minutes</p>
                    <div class="mt-4">
                        <h4 class="font-semibold text-[#1a1a1a]">Assign Candidates</h4>
                        <div class="flex items-center mt-2">
                            <input type="text" id="candidate-id" class="p-2 border border-[#d1d5db] rounded flex-grow text-[#1a1a1a]" placeholder="Enter Candidate ID">
                            <button id="assign-candidate-btn" class="ml-2 bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                                Assign
                            </button>
                        </div>
                        <ul id="assigned-candidates" class="mt-2 list-disc pl-5 text-[#1a1a1a]"></ul>
                    </div>
                    <div class="mt-4">
                        <div class="flex justify-between items-center">
                            <h4 class="font-semibold text-[#1a1a1a]">Questions</h4>
                            <button id="add-question-btn" class="bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                                Add Question
                            </button>
                        </div>
                        <div id="questions-list" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Question Modal -->
        <div id="edit-question-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">×</span>
                <h3 class="text-xl font-semibold mb-4 text-[#1a1a1a]">Edit Question</h3>
                <form id="edit-question-form">
                    <div class="mb-4">
                        <label for="edit-question-text" class="block text-sm font-medium text-[#1a1a1a]">Question</label>
                        <textarea id="edit-question-text" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#1a1a1a]">Options</label>
                        <input type="text" id="edit-option-1" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="edit-option-2" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="edit-option-3" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="edit-option-4" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                    </div>
                    <div class="mb-4">
                        <label for="edit-correct-option" class="block text-sm font-medium text-[#1a1a1a]">Correct Option</label>
                        <select id="edit-correct-option" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required>
                            <option value="0">Option 1</option>
                            <option value="1">Option 2</option>
                            <option value="2">Option 3</option>
                            <option value="3">Option 4</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                        Save Question
                    </button>
                </form>
            </div>
        </div>

        <!-- Add Question Modal -->
        <div id="add-question-modal" class="modal">
            <div class="modal-content">
                <span class="close-btn">×</span>
                <h3 class="text-xl font-semibold mb-4 text-[#1a1a1a]">Add New Question</h3>
                <form id="add-question-form">
                    <div class="mb-4">
                        <label for="add-question-text" class="block text-sm font-medium text-[#1a1a1a]">Question</label>
                        <textarea id="add-question-text" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required></textarea>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-[#1a1a1a]">Options</label>
                        <input type="text" id="add-option-1" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="add-option-2" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="add-option-3" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                        <input type="text" id="add-option-4" class="w-full p-2 border border-[#d1d5db] rounded mb-2 text-[#1a1a1a]" required>
                    </div>
                    <div class="mb-4">
                        <label for="add-correct-option" class="block text-sm font-medium text-[#1a1a1a]">Correct Option</label>
                        <select id="add-correct-option" class="w-full p-2 border border-[#d1d5db] rounded text-[#1a1a1a]" required>
                            <option value="0">Option 1</option>
                            <option value="1">Option 2</option>
                            <option value="2">Option 3</option>
                            <option value="3">Option 4</option>
                        </select>
                    </div>
                    <button type="submit" class="bg-[#6b7280] text-[#1a1a1a] px-4 py-2 rounded-lg hover:bg-[#4b5563]">
                        Add Question
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Sample test data with 15 tests (3 difficulty levels for 5 roles)
        let tests = [
            // Digital Marketing
            { id: 1, name: "Digital Marketing Basics", role: "Digital Marketing", dateAdded: "2025-05-20", duration: 30, candidates: [], questions: getSampleQuestions("Digital Marketing", "Beginner") },
            // SDE
            { id: 4, name: "SDE Basics", role: "SDE", dateAdded: "2025-05-20", duration: 30, candidates: [], questions: getSampleQuestions("SDE", "Beginner") },
            // Business Analyst
            { id: 7, name: "Business Analyst Basics", role: "Business Analyst", dateAdded: "2025-05-20", duration: 30, candidates: [], questions: getSampleQuestions("Business Analyst", "Beginner") },
 
            // Data Analyst
            { id: 10, name: "Data Analyst Basics", role: "Data Analyst", dateAdded: "2025-05-20", duration: 30, candidates: [], questions: getSampleQuestions("Data Analyst", "Beginner") },
            // Solution Engineer
            { id: 13, name: "Solution Engineer Basics", role: "Solution Engineer", dateAdded: "2025-05-20", duration: 30, candidates: [], questions: getSampleQuestions("Solution Engineer", "Beginner") },
        ];

        // Function to generate sample questions for each role and difficulty
        function getSampleQuestions(role, difficulty) {
            const baseQuestions = {
                "Digital Marketing": {
                    "Beginner": [
                        { id: 1, text: `What is SEO in ${role}?`, options: ["Search Engine Optimization", "Social Engagement Output", "Sales Enablement Option", "Systematic Email Outreach"], correct: 0 },
                        { id: 2, text: `What does PPC stand for in ${role}?`, options: ["Pay Per Click", "People Per Campaign", "Plan Per Conversion", "Post Per Content"], correct: 0 },
                        { id: 3, text: "What is a landing page?", options: ["A blog post", "A product page", "A page designed for conversions", "A homepage"], correct: 2 },
                        { id: 4, text: "What is a CTA?", options: ["Click To Action", "Call To Action", "Connect To Audience", "Create To Advertise"], correct: 1 },
                        { id: 5, text: `What is a keyword in ${role}?`, options: ["A type of ad", "A search term", "A social media post", "An email subject"], correct: 1 },
                        { id: 6, text: "What is A/B testing?", options: ["Testing two versions of a campaign", "Testing ad budgets", "Testing audience segments", "Testing brand logos"], correct: 0 },
                        { id: 7, text: "What is a conversion rate?", options: ["Percentage of visitors who take action", "Number of clicks", "Ad spend ratio", "Social media likes"], correct: 0 },
                        { id: 8, text: "What is content marketing?", options: ["Selling products online", "Creating valuable content to attract customers", "Running paid ads", "Email campaigns only"], correct: 1 },
                        { id: 9, text: "What is a bounce rate?", options: ["Visitors leaving after one page", "Email open rate", "Ad click rate", "Social media shares"], correct: 0 },
                        { id: 10, text: "What is a target audience?", options: ["All website visitors", "Specific group for marketing", "Ad network users", "Email subscribers"], correct: 1 }
                    ],
                },
                "SDE": {
                    "Beginner": [
                        { id: 1, text: `What is a variable in ${role}?`, options: ["A function", "A data storage", "A loop", "A class"], correct: 1 },
                        { id: 2, text: "What is a loop?", options: ["Repeats code", "Stores data", "Defines a class", "Calls a function"], correct: 0 },
                        { id: 3, text: "What is an array?", options: ["A single variable", "A collection of items", "A function", "A class"], correct: 1 },
                        { id: 4, text: "What is a function?", options: ["A reusable block of code", "A data type", "A loop", "A variable"], correct: 0 },
                        { id: 5, text: "What is debugging?", options: ["Writing code", "Fixing errors", "Compiling code", "Testing code"], correct: 1 },
                        { id: 6, text: "What is a string?", options: ["A number", "A sequence of characters", "A loop", "A function"], correct: 1 },
                        { id: 7, text: "What is a boolean?", options: ["True/False value", "A number", "A string", "A function"], correct: 0 },
                        { id: 8, text: "What is version control?", options: ["Manages code changes", "Compiles code", "Tests code", "Deploys code"], correct: 0 },
                        { id: 9, text: "What is an IDE?", options: ["Integrated Development Environment", "Internet Data Exchange", "Internal Development Engine", "Integrated Data Environment"], correct: 0 },
                        { id: 10, text: "What is a comment?", options: ["Executable code", "Non-executable explanation", "A function", "A variable"], correct: 1 }
                    ],
                },
                "Business Analyst": {
                    "Beginner": [
                        { id: 1, text: `What is a requirement in ${role}?`, options: ["A stakeholder need", "A data model", "A test case", "A report"], correct: 0 },
                        { id: 2, text: "What is a use case?", options: ["Describes system interactions", "A data table", "A report", "A test"], correct: 0 },
                        { id: 3, text: "What is a stakeholder?", options: ["Person with interest in project", "A developer", "A database", "A report"], correct: 0 },
                        { id: 4, text: "What is a flowchart?", options: ["Visualizes processes", "A database", "A report", "A test"], correct: 0 },
                        { id: 5, text: "What is SWOT analysis?", options: ["Strengths, Weaknesses, Opportunities, Threats", "A data model", "A test", "A report"], correct: 0 },
                        { id: 6, text: "What is a business process?", options: ["Set of activities to achieve a goal", "A database", "A report", "A test"], correct: 0 },
                        { id: 7, text: "What is a KPI?", options: ["Key Performance Indicator", "Key Process Input", "Key Project Index", "Key Plan Indicator"], correct: 0 },
                        { id: 8, text: "What is a gap analysis?", options: ["Compares current vs desired state", "A data model", "A test", "A report"], correct: 0 },
                        { id: 9, text: "What is a BRD?", options: ["Business Requirements Document", "Business Report Data", "Business Review Document", "Business Requirement Data"], correct: 0 },
                        { id: 10, text: "What is elicitation?", options: ["Gathering requirements", "Creating reports", "Testing systems", "Modeling data"], correct: 0 }
                    ],
                },
                "Data Analyst": {
                    "Beginner": [
                        { id: 1, text: `What is data cleaning in ${role}?`, options: ["Removing errors from data", "Creating reports", "Writing code", "Testing data"], correct: 0 },
                        { id: 2, text: "What is a dataset?", options: ["Collection of data", "A function", "A report", "A test"], correct: 0 },
                        { id: 3, text: "What is a mean?", options: ["Average of data", "A data type", "A function", "A test"], correct: 0 },
                        { id: 4, text: "What is a median?", options: ["Middle value of data", "A data type", "A function", "A test"], correct: 0 },
                        { id: 5, text: "What is a histogram?", options: ["Shows data distribution", "A data type", "A function", "A test"], correct: 0 },
                        { id: 6, text: "What is SQL?", options: ["Structured Query Language", "A data type", "A function", "A test"], correct: 0 },
                        { id: 7, text: "What is a spreadsheet?", options: ["Tool for data organization", "A data type", "A function", "A test"], correct: 0 },
                        { id: 8, text: "What is a pivot table?", options: ["Summarizes data", "A data type", "A function", "A test"], correct: 0 },
                        { id: 9, text: "What is a bar chart?", options: ["Compares categories", "A data type", "A function", "A test"], correct: 0 },
                        { id: 10, text: "What is data visualization?", options: ["Graphical representation of data", "A data type", "A function", "A test"], correct: 0 }
                    ],
                    
                },
                "Solution Engineer": {
                    "Beginner": [
                        { id: 1, text: `What is a solution architecture in ${role}?`, options: ["Designs system solutions", "A data model", "A report", "A test"], correct: 0 },
                        { id: 2, text: "What is a technical requirement?", options: ["System specifications", "A data model", "A report", "A test"], correct: 0 },
                        { id: 3, text: "What is a prototype?", options: ["Early model of a solution", "A data model", "A report", "A test"], correct: 0 },
                        { id: 4, text: "What is a client demo?", options: ["Shows solution to client", "A data model", "A report", "A test"], correct: 0 },
                        { id: 5, text: "What is a technical specification?", options: ["Details system requirements", "A data model", "A report", "A test"], correct: 0 },
                        { id: 6, text: "What is a proof of concept?", options: ["Tests solution feasibility", "A data model", "A report", "A test"], correct: 0 },
                        { id: 7, text: "What is a workflow?", options: ["Sequence of tasks", "A data model", "A report", "A test"], correct: 0 },
                        { id: 8, text: "What is a stakeholder meeting?", options: ["Discusses project needs", "A data model", "A report", "A test"], correct: 0 },
                        { id: 9, text: "What is a system integration?", options: ["Connects different systems", "A data model", "A report", "A test"], correct: 0 },
                        { id: 10, text: "What is a use case?", options: ["Describes system usage", "A data model", "A report", "A test"], correct: 0 }
                    ],
                    }
            };
            return baseQuestions[role][difficulty];
        }

        // Filter state
        let filters = {
            startDate: null,
            endDate: null,
            roles: []
        };

        // Load tests into the table based on filters
        function loadTests() {
            const tableBody = document.getElementById('tests-table-body');
            tableBody.innerHTML = '';

            const filteredTests = tests.filter(test => {
                // Date filter
                let passesDateFilter = true;
                const testDate = new Date(test.dateAdded);
                if (filters.startDate) {
                    const startDate = new Date(filters.startDate);
                    passesDateFilter = passesDateFilter && testDate >= startDate;
                }
                if (filters.endDate) {
                    const endDate = new Date(filters.endDate);
                    passesDateFilter = passesDateFilter && testDate <= endDate;
                }

                // Role filter
                let passesRoleFilter = true;
                if (filters.roles.length > 0) {
                    passesRoleFilter = filters.roles.includes(test.role);
                }

                // Combine filters (all must pass)
                return passesDateFilter && passesRoleFilter;
            });

            filteredTests.forEach(test => {
                const row = document.createElement('tr');
                row.className = 'border-b border-[#d1d5db]';
                row.innerHTML = `
                    <td class="p-3 text-[#1a1a1a]">${test.name}</td>
                    <td class="p-3 text-[#1a1a1a]">${test.role}</td>
                    <td class="p-3 text-[#1a1a1a]">${test.dateAdded}</td>
                    <td class="p-3">
                        <button class="view-details-btn text-[#6b7280] hover:underline hover:text-[#4b5563] mr-2" data-id="${test.id}">View Details</button>
                        <button class="delete-test-btn text-[#4b5563] hover:underline hover:text-[#374151]" data-id="${test.id}">Delete</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Add event listeners for view details and delete buttons
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', () => showTestDetails(btn.dataset.id));
            });
            document.querySelectorAll('.delete-test-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteTest(btn.dataset.id));
            });
        }

        // Show Add Test Modal
        const addTestBtn = document.getElementById('add-test-btn');
        const addTestModal = document.getElementById('add-test-modal');
        const addTestForm = document.getElementById('add-test-form');
        addTestBtn.addEventListener('click', () => {
            addTestModal.style.display = 'block';
        });

        // Close Modals
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').style.display = 'none';
            });
        });

        // Add Test Form Submission
        addTestForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const testName = document.getElementById('test-name').value;
            const testRole = document.getElementById('test-role').value;
            const testDuration = document.getElementById('test-duration').value;
            const newTest = {
                id: tests.length + 1,
                name: testName,
                role: testRole,
                dateAdded: new Date().toISOString().split('T')[0],
                duration: parseInt(testDuration),
                candidates: [],
                questions: []
            };
            tests.push(newTest);
            loadTests();
            addTestModal.style.display = 'none';
            addTestForm.reset();
        });

        // Show Test Details Modal
        const testDetailsModal = document.getElementById('test-details-modal');
        const editQuestionModal = document.getElementById('edit-question-modal');
        const editQuestionForm = document.getElementById('edit-question-form');
        const addQuestionModal = document.getElementById('add-question-modal');
        const addQuestionForm = document.getElementById('add-question-form');

        function showTestDetails(testId) {
            const test = tests.find(t => t.id == testId);
            if (!test) return;

            document.getElementById('details-test-name').textContent = test.name;
            document.getElementById('details-role').textContent = test.role;
            document.getElementById('details-date-added').textContent = test.dateAdded;
            document.getElementById('details-duration').textContent = test.duration;

            // Load assigned candidates
            const assignedCandidatesList = document.getElementById('assigned-candidates');
            assignedCandidatesList.innerHTML = test.candidates.length
                ? test.candidates.map(id => `<li>${id}</li>`).join('')
                : '<li>No candidates assigned yet.</li>';

            // Load questions
            const questionsList = document.getElementById('questions-list');
            questionsList.innerHTML = test.questions.length
                ? test.questions.map((q, index) => `
                    <div class="question-item">
                        <p class="text-[#1a1a1a]"><strong>Question ${index + 1}:</strong> ${q.text}</p>
                        <ol class="list-decimal pl-5 text-[#1a1a1a]">
                            ${q.options.map((opt, i) => `<li${i === q.correct ? ' class="font-bold"' : ''}>${opt}</li>`).join('')}
                        </ol>
                        <div class="mt-2">
                            <button class="edit-question-btn text-[#6b7280] hover:underline hover:text-[#4b5563] mr-2" data-test-id="${test.id}" data-question-id="${q.id}">Edit</button>
                            <button class="delete-question-btn text-[#4b5563] hover:underline hover:text-[#374151]" data-test-id="${test.id}" data-question-id="${q.id}">Delete</button>
                        </div>
                    </div>
                `).join('')
                : '<p class="text-[#1a1a1a]">No questions assigned yet.</p>';

            testDetailsModal.style.display = 'block';

            // Assign Candidate Button
            const assignCandidateBtn = document.getElementById('assign-candidate-btn');
            assignCandidateBtn.onclick = () => {
                const candidateId = document.getElementById('candidate-id').value.trim();
                if (candidateId && !test.candidates.includes(candidateId)) {
                    test.candidates.push(candidateId);
                    assignedCandidatesList.innerHTML = test.candidates.length
                        ? test.candidates.map(id => `<li>${id}</li>`).join('')
                        : '<li>No candidates assigned yet.</li>';
                    document.getElementById('candidate-id').value = '';
                }
            };

            // Add Question Button
            const addQuestionBtn = document.getElementById('add-question-btn');
            addQuestionBtn.onclick = () => {
                addQuestionModal.style.display = 'block';
                addQuestionForm.onsubmit = (e) => {
                    e.preventDefault();
                    const newQuestion = {
                        id: test.questions.length + 1,
                        text: document.getElementById('add-question-text').value,
                        options: [
                            document.getElementById('add-option-1').value,
                            document.getElementById('add-option-2').value,
                            document.getElementById('add-option-3').value,
                            document.getElementById('add-option-4').value
                        ],
                        correct: parseInt(document.getElementById('add-correct-option').value)
                    };
                    test.questions.push(newQuestion);
                    addQuestionModal.style.display = 'none';
                    addQuestionForm.reset();
                    showTestDetails(testId); // Refresh test details
                };
            };

            // Add event listeners for edit and delete question buttons
            document.querySelectorAll('.edit-question-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const testId = btn.dataset.testId;
                    const questionId = btn.dataset.questionId;
                    showEditQuestionModal(testId, questionId);
                });
            });
            document.querySelectorAll('.delete-question-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const testId = btn.dataset.testId;
                    const questionId = btn.dataset.questionId;
                    deleteQuestion(testId, questionId);
                });
            });
        }

        // Show Edit Question Modal
        function showEditQuestionModal(testId, questionId) {
            const test = tests.find(t => t.id == testId);
            const question = test.questions.find(q => q.id == questionId);
            if (!question) return;

            document.getElementById('edit-question-text').value = question.text;
            document.getElementById('edit-option-1').value = question.options[0];
            document.getElementById('edit-option-2').value = question.options[1];
            document.getElementById('edit-option-3').value = question.options[2];
            document.getElementById('edit-option-4').value = question.options[3];
            document.getElementById('edit-correct-option').value = question.correct;

            editQuestionModal.style.display = 'block';

            // Handle Edit Question Form Submission
            editQuestionForm.onsubmit = (e) => {
                e.preventDefault();
                question.text = document.getElementById('edit-question-text').value;
                question.options = [
                    document.getElementById('edit-option-1').value,
                    document.getElementById('edit-option-2').value,
                    document.getElementById('edit-option-3').value,
                    document.getElementById('edit-option-4').value
                ];
                question.correct = parseInt(document.getElementById('edit-correct-option').value);
                editQuestionModal.style.display = 'none';
                editQuestionForm.reset();
                showTestDetails(testId); // Refresh test details
            };
        }

        // Delete Question
        function deleteQuestion(testId, questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                const test = tests.find(t => t.id == testId);
                test.questions = test.questions.filter(q => q.id != questionId);
                showTestDetails(testId); // Refresh test details
            }
        }

        // Delete Test
        function deleteTest(testId) {
            if (confirm('Are you sure you want to delete this test?')) {
                tests = tests.filter(t => t.id != testId);
                loadTests();
            }
        }

        // Filter Handling
        const startDateInput = document.getElementById('start-date');
        const endDateInput = document.getElementById('end-date');
        const roleSelect = document.getElementById('role-select');
        const roleOptions = document.getElementById('role-options');
        const clearFiltersBtn = document.getElementById('clear-filters');

        // Date Filter
        startDateInput.addEventListener('change', () => {
            filters.startDate = startDateInput.value;
            loadTests();
        });
        endDateInput.addEventListener('change', () => {
            filters.endDate = endDateInput.value;
            loadTests();
        });

        // Role Filter (Multi-select)
        roleSelect.addEventListener('click', () => {
            roleOptions.style.display = roleOptions.style.display === 'block' ? 'none' : 'block';
        });

        roleOptions.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                filters.roles = Array.from(roleOptions.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.value);
                roleSelect.textContent = filters.roles.length > 0 ? filters.roles.join(', ') : 'Select Roles';
                loadTests();
            });
        });

        // Close role options when clicking outside
        document.addEventListener('click', (e) => {
            if (!roleSelect.contains(e.target) && !roleOptions.contains(e.target)) {
                roleOptions.style.display = 'none';
            }
        });

        // Clear Filters
        clearFiltersBtn.addEventListener('click', () => {
            filters = { startDate: null, endDate: null, roles: [] };
            startDateInput.value = '';
            endDateInput.value = '';
            roleSelect.textContent = 'Select Roles';
            roleOptions.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            loadTests();
        });

        // Initial Load
        loadTests();
    </script>
</body>
</html>